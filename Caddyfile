{
    # Global options
    admin off
    auto_https off
}

# HTTP server - redirect to HTTPS if domain is used
:80 {
    # If accessing via domain, redirect to HTTPS
    @domain {
        host catalog.container365.ru
    }
    redir @domain https://{host}{uri} permanent

    # Otherwise, serve directly (for IP access)
    reverse_proxy localhost:3001
}

# HTTPS server with automatic SSL
catalog.container365.ru:443 {
    # Automatic HTTPS with Let's Encrypt
    tls {
        # Let's Encrypt will automatically obtain certificate
        # Certificates stored in /data/caddy
    }

    # Reverse proxy to Node.js app
    reverse_proxy localhost:3001 {
        # Health check
        health_uri /
        health_interval 10s
        health_timeout 5s
    }

    # Logging
    log {
        output stdout
        format console
    }
}
