{
    # Global options
    admin off
    # Enable automatic HTTPS
    email admin@container365.ru
}

# HTTP server on port 80
:80 {
    # If accessing via domain, redirect to HTTPS
    @domain {
        host catalog.container365.ru
    }
    redir @domain https://{host}{uri} permanent

    # For IP access or non-matching domains, proxy directly
    reverse_proxy localhost:3001
}

# HTTPS server on port 443 with automatic SSL
catalog.container365.ru:443 {
    # Automatic HTTPS with Let's Encrypt
    # Certificates will be stored in /data/caddy
    
    # Reverse proxy to Node.js app
    reverse_proxy localhost:3001 {
        # Forward real IP
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }

    # Logging
    log {
        output stdout
        format console
        level INFO
    }
}
